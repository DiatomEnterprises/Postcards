(function withAngular(b){b.module("720kb.datepicker",[]).directive("datepicker",["$window","$compile","$locale","$filter",function a(h,f,e,g){var d=86400000;return{restrict:"AEC",scope:{dateSet:"@",dateMinLimit:"@",dateMaxLimit:"@"},link:function c(s,t,w){var q=w.selector,af=b.element(q?t[0].querySelector("."+q):t[0].children[0]),F,m='<b class="datepicker-default-button">&lang;</b>',I='<b class="datepicker-default-button">&rang;</b>',V=w.buttonPrev||m,A=w.buttonNext||I,B=w.dateFormat,G,P,ab=new Date(),Q=false,n=false,p=e.DATETIME_FORMATS,r,ad='<div class="_720kb-datepicker-calendar" ng-blur="hideCalendar()"><div class="_720kb-datepicker-calendar-header" ng-hide="isMobile()"><div class="_720kb-datepicker-calendar-header-left"><a href="javascript:void(0)" ng-click="prevMonth()">'+V+'</a></div><div class="_720kb-datepicker-calendar-header-middle _720kb-datepicker-calendar-month">{{month}} <a href="javascript:void(0)" ng-click="showYearsPagination = !showYearsPagination"><span>{{year}} <i ng-if="!showYearsPagination">&dtrif;</i> <i ng-if="showYearsPagination">&urtri;</i> </span> </a></div><div class="_720kb-datepicker-calendar-header-right"><a href="javascript:void(0)" ng-click="nextMonth()">'+A+'</a></div></div><div class="_720kb-datepicker-calendar-header" ng-show="isMobile()"><div class="_720kb-datepicker-calendar-header-middle _720kb-datepicker-mobile-item _720kb-datepicker-calendar-month"><select ng-model="month" ng-change="selectedMonthHandle(month)"><option ng-repeat="item in months" ng-selected="month === item" ng-disabled=\'!isSelectableMaxDate(item + " " + day + ", " + year) || !isSelectableMinDate(item + " " + day + ", " + year)\' ng-value="item">{{item}}</option></select></div></div><div class="_720kb-datepicker-calendar-header" ng-show="isMobile()"><div class="_720kb-datepicker-calendar-header-middle _720kb-datepicker-mobile-item _720kb-datepicker-calendar-month"><select ng-model="mobileYear" ng-change="setNewYear(mobileYear)"><option ng-repeat="item in paginationYears" ng-selected="year === item" ng-value="item" ng-disabled="!isSelectableMinYear(item) || !isSelectableMaxYear(item)">{{item}}</option></select></div></div><div class="_720kb-datepicker-calendar-header" ng-show="showYearsPagination"><div class="_720kb-datepicker-calendar-years-pagination"><a ng-class="{\'_720kb-datepicker-active\': y === year, \'_720kb-datepicker-disabled\': !isSelectableMaxYear(y) || !isSelectableMinYear(y)}" href="javascript:void(0)" ng-click="setNewYear(y)" ng-repeat="y in paginationYears">{{y}}</a></div><div class="_720kb-datepicker-calendar-years-pagination-pages"><a href="javascript:void(0)" ng-click="paginateYears(paginationYears[0])" ng-class="{\'_720kb-datepicker-item-hidden\': paginationYearsPrevDisabled}">'+V+'</a><a href="javascript:void(0)" ng-click="paginateYears(paginationYears[paginationYears.length -1 ])" ng-class="{\'_720kb-datepicker-item-hidden\': paginationYearsNextDisabled}">'+A+'</a></div></div><div class="_720kb-datepicker-calendar-days-header"><div ng-repeat="d in daysInString"> {{d}} </div> </div><div class="_720kb-datepicker-calendar-body"><a href="javascript:void(0)" ng-repeat="px in prevMonthDays" class="_720kb-datepicker-calendar-day _720kb-datepicker-disabled">{{px}}</a><a href="javascript:void(0)" ng-repeat="item in days" ng-click="setDatepickerDay(item)" ng-class="{\'_720kb-datepicker-active\': day === item, \'_720kb-datepicker-disabled\': !isSelectableMinDate(year + \'/\' + monthNumber + \'/\' + item ) || !isSelectableMaxDate(year + \'/\' + monthNumber + \'/\' + item)}" class="_720kb-datepicker-calendar-day">{{item}}</a><a href="javascript:void(0)" ng-repeat="nx in nextMonthDays" class="_720kb-datepicker-calendar-day _720kb-datepicker-disabled">{{nx}}</a></div></div></div>';s.$watch("dateSet",function T(ag){if(ag){ab=new Date(ag);s.month=g("date")(ab,"MMMM");s.monthNumber=Number(g("date")(ab,"MM"));s.day=Number(g("date")(ab,"dd"));s.year=Number(g("date")(ab,"yyyy"));s.setDaysInMonth(s.monthNumber,s.year)}});s.$watch("dateMinLimit",function L(ag){if(ag){G=ag}});s.$watch("dateMaxLimit",function W(ag){if(ag){P=ag}});s.month=g("date")(ab,"MMMM");s.monthNumber=Number(g("date")(ab,"MM"));s.day=Number(g("date")(ab,"dd"));s.year=Number(g("date")(ab,"yyyy"));s.months=p.MONTH;s.daysInString=["0","1","2","3","4","5","6"].map(function v(ag){return g("date")(new Date(new Date("06/08/2014").valueOf()+d*ag),"EEE")});af.after(f(b.element(ad))(s));F=t[0].querySelector("._720kb-datepicker-calendar");af.bind("focus click",function aa(){n=true;s.showCalendar()});af.bind("focusout",function o(){n=false});b.element(F).bind("mouseenter",function z(){Q=true});b.element(F).bind("mouseleave",function E(){Q=false});b.element(F).bind("focusin",function R(){Q=true});b.element(h).bind("click focus",function i(){if(!Q&&!n){s.hideCalendar()}});s.isMobile=function H(){if(navigator.userAgent&&(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))){return true}};s.resetToMinDate=function C(){s.month=g("date")(new Date(G),"MMMM");s.monthNumber=Number(g("date")(new Date(G),"MM"));s.day=Number(g("date")(new Date(G),"dd"));s.year=Number(g("date")(new Date(G),"yyyy"))};s.resetToMaxDate=function J(){s.month=g("date")(new Date(P),"MMMM");s.monthNumber=Number(g("date")(new Date(P),"MM"));s.day=Number(g("date")(new Date(P),"dd"));s.year=Number(g("date")(new Date(P),"yyyy"))};s.nextMonth=function S(){if(s.monthNumber===12){s.monthNumber=1;s.nextYear()}else{s.monthNumber+=1}s.month=g("date")(new Date(s.year+"/"+s.monthNumber+"/01"),"MMMM");s.setDaysInMonth(s.monthNumber,s.year);if(P){if(!s.isSelectableMaxDate(s.year+"/"+s.monthNumber+"/"+s.day)){s.resetToMaxDate()}}s.day=undefined};s.selectedMonthHandle=function K(ag){s.monthNumber=Number(g("date")(new Date("01 "+ag+" 2000"),"MM"));s.setDaysInMonth(s.monthNumber,s.year);s.setInputValue()};s.prevMonth=function M(){if(s.monthNumber===1){s.monthNumber=12;s.prevYear()}else{s.monthNumber-=1}s.month=g("date")(new Date(s.year+"/"+s.monthNumber+"/01"),"MMMM");s.setDaysInMonth(s.monthNumber,s.year);if(G){if(!s.isSelectableMinDate(s.year+"/"+s.monthNumber+"/"+s.day)){s.resetToMinDate()}}s.day=undefined};s.setNewYear=function O(ag){s.day=undefined;if(P&&s.year<Number(ag)){if(!s.isSelectableMaxYear(ag)){return}}else{if(G&&s.year>Number(ag)){if(!s.isSelectableMinYear(ag)){return}}}s.year=Number(ag);s.setDaysInMonth(s.monthNumber,s.year);s.paginateYears(ag)};s.nextYear=function j(){s.year=Number(s.year)+1};s.prevYear=function Z(){s.year=Number(s.year)-1};s.setInputValue=function y(){if(s.isSelectableMinDate(s.year+"/"+s.monthNumber+"/"+s.day)&&s.isSelectableMaxDate(s.year+"/"+s.monthNumber+"/"+s.day)){var ag=new Date(s.year+"/"+s.monthNumber+"/"+s.day);if(w.dateFormat){af.val(g("date")(ag,B))}else{af.val(ag)}af.triggerHandler("input");af.triggerHandler("change")}else{return false}};s.classHelper={add:function k(ai,ag){if(ai.className.indexOf(ag)>-1){return}var ah=ai.className.split(" ");ah.push(ag);ai.className=ah.join(" ")},remove:function D(aj,ag){var ai,ah;if(aj.className.indexOf(ag)===-1){return}ah=aj.className.split(" ");for(ai=0;ai<ah.length;ai+=1){if(ah[ai]===ag){ah=ah.slice(0,ai).concat(ah.slice(ai+1));break}}aj.className=ah.join(" ")}};s.showCalendar=function x(){r=h.document.getElementsByClassName("_720kb-datepicker-calendar");b.forEach(r,function ag(ai,ah){if(r[ah].classList){r[ah].classList.remove("_720kb-datepicker-open")}else{s.classHelper.remove(r[ah],"_720kb-datepicker-open")}});if(F.classList){F.classList.add("_720kb-datepicker-open")}else{s.classHelper.add(F,"_720kb-datepicker-open")}};s.hideCalendar=function Y(){if(F.classList){F.classList.remove("_720kb-datepicker-open")}else{s.classHelper.remove(F,"_720kb-datepicker-open")}};s.setDaysInMonth=function u(an,ap){var al,ao=new Date(ap,an,0).getDate(),am=new Date(ap+"/"+an+"/"+1).getDay(),ag=new Date(ap+"/"+an+"/"+ao).getDay(),ak=[],ai=[],aq,aj,ah;s.days=[];for(al=1;al<=ao;al+=1){s.days.push(al)}if(am!==0){aj=am;if(Number(an)===1){ah=12}else{ah=an-1}for(al=1;al<=new Date(ap,ah,0).getDate();al+=1){ak.push(al)}s.prevMonthDays=ak.slice(-aj)}else{s.prevMonthDays=[]}if(ag<6){aq=6-ag;for(al=1;al<=aq;al+=1){ai.push(al)}s.nextMonthDays=ai}else{s.nextMonthDays=[]}};s.setDatepickerDay=function ac(ag){s.day=Number(ag);s.setInputValue();s.hideCalendar()};s.paginateYears=function X(aj){s.paginationYears=[];var ah,ag=[],ai=10;if(s.isMobile()){ai=50}for(ah=ai;ah>0;ah-=1){ag.push(Number(aj)-ah)}for(ah=0;ah<ai;ah+=1){ag.push(Number(aj)+ah)}if(P&&ag&&ag.length&&!s.isSelectableMaxYear(Number(ag[ag.length-1])+1)){s.paginationYearsNextDisabled=true}else{s.paginationYearsNextDisabled=false}if(G&&ag&&ag.length&&!s.isSelectableMinYear(Number(ag[0])-1)){s.paginationYearsPrevDisabled=true}else{s.paginationYearsPrevDisabled=false}s.paginationYears=ag};s.isSelectableMinDate=function N(ag){if(!!G&&!!new Date(G)&&new Date(ag).getTime()<new Date(G).getTime()){return false}return true};s.isSelectableMaxDate=function U(ag){if(!!P&&!!new Date(P)&&new Date(ag).getTime()>new Date(P).getTime()){return false}return true};s.isSelectableMaxYear=function l(ag){if(!!P&&ag>new Date(P).getFullYear()){return false}return true};s.isSelectableMinYear=function ae(ag){if(!!G&&ag<new Date(G).getFullYear()){return false}return true};if(G&&!s.isSelectableMinYear(s.year)){s.resetToMinDate()}if(P&&!s.isSelectableMaxYear(s.year)){s.resetToMaxDate()}s.paginateYears(s.year);s.setDaysInMonth(s.monthNumber,s.year)}}}])}(angular));